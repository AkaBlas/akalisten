{% from 'render_card_grid.j2' import render_card_grid %}
{% macro render_forms(forms) %}
{% set cards = [] %}
{% for form in forms %}
    {% set desc_len = form.html_description|length if form.html_description is defined and form.html_description else 0 %}
    {% if desc_len > 600 %}
        {% set col_class = "col-12 col-md-12 col-lg-12" %}
    {% elif desc_len > 300 %}
        {% set col_class = "col-12 col-md-6 col-lg-6" %}
    {% else %}
        {% set col_class = "col-12 col-md-6 col-lg-4" %}
    {% endif %}
    {% set body %}
        {% if form.expire_date %}
            <p class="mb-2">
                <span class="d-flex align-items-center">
                    <i class="bi bi-calendar-week me-2"></i>
                    <b>Formular offen bis:</b>&nbsp;{{ form.expire_date.strftime('%d.%m.%Y %H:%M') }} Uhr
                </span>
            </p>
        {% endif %}
        {% if form.html_description %}
            <p class="card-text mb-0">
                {{ form.html_description }}
            </p>
        {% endif %}
    {% endset %}
    {% set buttons = [] %}
    {% if form.url %}
        {% set _ = buttons.append({
            "icon": "cloud-check",
            "text": "Ausfüllen mit AkaCloud-Account",
            "target": form.url,
            "css_class": "btn btn-outline-success"
        }) %}
    {% endif %}
    {% if form.public_url %}
        {% set _ = buttons.append({
            "icon": "pencil-fill",
            "text": "Ausfüllen ohne AkaCloud-Account",
            "target": form.public_url,
            "css_class": "btn btn-outline-primary"
        }) %}
    {% endif %}
    {% set card = {
        "title": form.html_title,
        "body": body,
        "buttons": buttons,
        "width": col_class
    } %}
    {% set _ = cards.append(card) %}
{% endfor %}
{{ render_card_grid(cards) }}
{# Einbettung bleibt separat #}
{% for form in forms %}
    {% if form.embed_url %}
        <div class="card mt-3">
            <div class="card-header">
                <span class="d-flex align-items-center">
                    <i class="bi bi-pencil-square me-2"></i>
                    Ohne AkaCloud-Account direkt ausfüllen
                </span>
            </div>
            <div class="card-body">
                <iframe src="{{ form.embed_url }}" width="100%" height="800px"
                        class="embedding-content"></iframe>
            </div>
        </div>
    {% endif %}
{% endfor %}
{% endmacro %}