{% from 'render_card_grid.j2' import render_card_grid %}
{% from 'render_truncate_text.j2' import render_truncate_text %}
{% macro render_lists(lists) %}
{% set cards = [] %}
{% for list in lists %}
{% set desc_len = list.html_description|length if list.html_description is defined and list.html_description else 0 %}
{% if desc_len > 1000 %}
    {% set columns = 3 %}
{% elif desc_len > 500 %}
    {% set columns = 2 %}
{% else %}
    {% set columns = 1 %}
{% endif %}
{% set body %}
{% if list.expire_date %}
    <p class="mb-2">
                <span class="d-flex align-items-center">
                    <i class="bi bi-calendar-week me-2"></i>
                    <b>Liste verf√ºgbar bis:</b>&nbsp;{{ list.expire_date.strftime('%d.%m.%Y') }}
                </span>
    </p>
{% endif %}
{% if list.html_description %}
    {% if columns >= 2 %}
        {{ render_truncate_text(list.html_description, 'list-' ~ loop.index) }}
    {% else %}
        <p class="card-text mb-0">
            {{ list.html_description }}
        </p>
    {% endif %}
{% endif %}
{% endset %}
{% set buttons = [] %}
{% if list.available_offline %}
    {% set _ = buttons.append({
            "icon": "wifi-off",
            "text": "Eintragen offline bei der Probe",
            "target": None,
            "css_class": " btn-outline-secondary disabled"
        }) %}
{% endif %}
{% if list.login_url %}
    {% set _ = buttons.append({
            "icon": "cloud-check",
            "text": "Eintragen mit AkaCloud-Account",
            "target": list.login_url,
            "css_class": " btn-outline-success"
        }) %}
{% endif %}
{% if list.basic_url %}
    {% set _ = buttons.append({
            "icon": "pencil-fill",
            "text": "Eintragen ohne AkaCloud-Account",
            "target": list.basic_url,
            "css_class": " btn-outline-primary"
        }) %}
{% endif %}
{% set card = {
        "title": list.html_title,
        "body": body,
        "buttons": buttons,
        "columns": columns
    } %}
{% set _ = cards.append(card) %}
{% endfor %}
{{ render_card_grid(cards, label="lists") }}
{% endmacro %}